### 深入理解JAVA虚拟机读书笔记
-----

#### 关于CMS收集器
CMS用的是`标记-清除`算法，分为四个阶段：初始标记（CMS initial mark），并发标记（CMS concurrent mark），重新标记（CMS remark），并发清除（CMS concurrent sweep）。并发标记和并发清除的速度最慢，但是是与用户线程同时进行的。另外两个阶段比较快，但是需要STW。
CMS的缺点：
1. CPU敏感。默认启动的线程数是（CPU数量+3）/4，如果只有两个，那么就要分出一个核去执行垃圾回收，速度直接慢了一半。
2. 无法处理浮动垃圾。可能出现`Concurrent Mode Failure`，由于并发清除的时候用户线程也在运行，CMS无法在本次GC中清理新的垃圾，只能留待下一次的GC，而且还需要流出足够的空间在收集垃圾的时候给用户使用，如果预留的空间不足就会出现上面说的`CMF`。这是虚拟机将启动备案：临时使用`Serial Old`重新对老年代回收。
3. 会产生很多碎片。不过虚拟机默认每次CMS收集老年代的时候都会进行一次碎片整理。我们可以设置每进行多少次不压缩的CMS GC，跟着进行一次整理的。

#### 关于GC日志
Full GC仅仅表示这次GC过程中发生了STW，而一般的GC则表示没有停顿。新生代的ParNew的日志也会出现Full GC（一般是出现了分配担保失败之类的问题）。